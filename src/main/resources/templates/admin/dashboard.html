<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{admin/layout/main}">
<head>
    <title>Dashboard</title>
</head>
<body>

<!-- Page Title -->
<div layout:fragment="page-title">
    <i class="fas fa-tachometer-alt"></i> Dashboard
</div>

<!-- Breadcrumb -->
<ol class="breadcrumb float-sm-right" layout:fragment="breadcrumb">
    <li class="breadcrumb-item active">Dashboard</li>
</ol>

<!-- Main Content -->
<div layout:fragment="content">
    
    <!-- Welcome Alert -->
    <div class="alert alert-success alert-dismissible fade show">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <h5><i class="icon fas fa-check"></i> Welcome!</h5>
        You are successfully logged in as <strong th:text="${username}">admin@example.com</strong>
    </div>

    <!-- Info boxes -->
    <div class="row">
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1">
                    <i class="fas fa-users"></i>
                </span>
                <div class="info-box-content">
                    <span class="info-box-text">Total Users</span>
                    <span class="info-box-number" th:text="${totalUsers}">0</span>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box mb-3">
                <span class="info-box-icon bg-success elevation-1">
                    <i class="fas fa-map-marked-alt"></i>
                </span>
                <div class="info-box-content">
                    <span class="info-box-text">Active Tours</span>
                    <span class="info-box-number" th:text="${activeTours}">0</span>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box mb-3">
                <span class="info-box-icon bg-warning elevation-1">
                    <i class="fas fa-calendar-check"></i>
                </span>
                <div class="info-box-content">
                    <span class="info-box-text">Total Bookings</span>
                    <span class="info-box-number" th:text="${totalBookings}">0</span>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-sm-6 col-md-3">
            <div class="info-box mb-3">
                <span class="info-box-icon bg-danger elevation-1">
                    <i class="fas fa-dollar-sign"></i>
                </span>
                <div class="info-box-content">
                    <span class="info-box-text">Total Revenue</span>
                    <span class="info-box-number" th:text="${'$' + #numbers.formatDecimal(totalRevenue, 1, 2)}">$0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Cards -->
    <div class="row">
        <div class="col-lg-4 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3 th:text="${pendingBookings}">0</h3>
                    <p>Pending Bookings</p>
                </div>
                <div class="icon">
                    <i class="fas fa-clock"></i>
                </div>
                <a href="/admin/bookings?status=PENDING" class="small-box-footer">
                    More info <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-4 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3 th:text="${totalCategories}">0</h3>
                    <p>Total Categories</p>
                </div>
                <div class="icon">
                    <i class="fas fa-list"></i>
                </div>
                <a href="/admin/categories" class="small-box-footer">
                    More info <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-4 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3 th:text="${'$' + #numbers.formatDecimal(pendingPayments, 1, 2)}">$0</h3>
                    <p>Pending Payments</p>
                </div>
                <div class="icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <a href="/admin/bookings?paymentStatus=PENDING" class="small-box-footer">
                    More info <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row">
        <div class="col-md-8">
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line mr-1"></i>
                        Monthly Revenue (Last 12 Months)
                    </h3>
                </div>
                <div class="card-body">
                    <canvas id="monthlyRevenueChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-danger">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-pie mr-1"></i>
                        Revenue Breakdown
                    </h3>
                </div>
                <div class="card-body">
                    <canvas id="revenueBreakdownChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activities -->
    <div class="row">
        <div class="col-md-6">
            <div class="card card-info">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-check mr-1"></i>
                        Latest Bookings
                    </h3>
                </div>
                <div class="card-body p-0">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>User</th>
                                <th>Tour</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(recentBookings)}">
                                <td colspan="4" class="text-center text-muted">No bookings yet</td>
                            </tr>
                            <tr th:each="booking : ${recentBookings}">
                                <td>
                                    <a th:href="@{/admin/bookings/{id}(id=${booking.id})}" 
                                       th:text="${booking.bookingCode}">BK001</a>
                                </td>
                                <td th:text="${booking.userName}">User Name</td>
                                <td th:text="${#strings.abbreviate(booking.tourTitle, 30)}">Tour Title</td>
                                <td>
                                    <span class="badge"
                                          th:classappend="${booking.status?.toString() == 'CONFIRMED' ? 'badge-success' : 
                                                           booking.status?.toString() == 'PENDING' ? 'badge-warning' : 
                                                           booking.status?.toString() == 'CANCELLED' ? 'badge-danger' : 
                                                           'badge-secondary'}"
                                          th:text="${booking.status}">Status</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card-footer text-center">
                    <a th:href="@{/admin/bookings}" class="btn btn-sm btn-info">View All Bookings</a>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card card-success">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-star mr-1"></i>
                        Latest Reviews
                    </h3>
                </div>
                <div class="card-body p-0">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(recentReviews)}">
                                <td colspan="4" class="text-center text-muted">No reviews yet</td>
                            </tr>
                            <tr th:each="review : ${recentReviews}">
                                <td th:text="${review.userName}">User Name</td>
                                <td>
                                    <a th:href="@{/admin/reviews/{id}(id=${review.id})}"
                                       th:text="${#strings.abbreviate(review.title, 30)}">Review Title</a>
                                </td>
                                <td>
                                    <span class="badge badge-primary" th:text="${review.categoryType}">Type</span>
                                </td>
                                <td>
                                    <span class="badge"
                                          th:classappend="${review.isActive ? 'badge-success' : 'badge-secondary'}"
                                          th:text="${review.isActive ? 'Active' : 'Hidden'}">Status</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card-footer text-center">
                    <a th:href="@{/admin/reviews}" class="btn btn-sm btn-success">View All Reviews</a>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Custom scripts for charts -->
<th:block layout:fragment="scripts">
    <script th:src="@{/admin/plugins/chart.js/chart.min.js}"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $(function() {
            var monthlyData = /*[[${monthlyRevenue}]]*/ {};
            var breakdownData = /*[[${revenueBreakdown}]]*/ {};
            
            // Initialize charts using the function from admin-custom.js
            if (typeof window.initDashboardCharts === 'function') {
                window.initDashboardCharts(monthlyData, breakdownData);
            }
        });
        /*]]>*/
    </script>
</th:block>

</body>
</html>
